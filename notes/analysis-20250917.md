# 2025-09-17 C2-Graph 試作結果メモ

## 実行概要
- スクリプト: `scripts/prototype/c2_graph_baseline.py`, `scripts/prototype/c2_batch_report.py`
- データ: `data/sample/meeting-sample-001.json`, `data/sample/meeting-sample-002.json`
- 出力: `runs/20250917-c2-proto/report.md`, `runs/20250917-c2-proto/batch_report.md`

## 主な観察
1. **権限外CANCEL検出**
   - sample-001 の turn10 (Bob→C2), turn13 (Dave→C3) を `unauthorized_cancel` として検出。
   - REVISE後にオーナーがAliceへ移ったC3では、`cancel_before_confirmation` も同時検出。
2. **矛盾率の算出**
   - sample-001: コミットメント3件中2件が矛盾（率0.67）。
   - sample-002: 矛盾なし、正常ストーリー。
   - バッチ集計では 5件中2件が矛盾で矛盾率0.40。
3. **ルール拡張効果**
   - `requires_confirmation` フラグ導入により、REVISE後直ちにCANCELした場合の矛盾が明示化。
   - 将来的には期限超過判定など時間軸ルールを追加予定。
4. **矛盾タイプ別の修正提案**
   - `CONTRADICTION_SUGGESTIONS` を追加し、各矛盾に再発防止アクション（例: オーナー合意を得てからCANCEL）を付記。
   - `meeting-sample-003` を作成し、`cancel_without_assignment`/`duplicate_cancel`/`cancel_before_confirmation`/`unauthorized_cancel` を網羅的に確認。矛盾率は0.62、提案文付きレポートを `runs/20250917-c2-proto-v2/` に出力。

## 次に試すべきこと
- 実データ（AMI/ICSI）のアクションアイテムアノテーションへの適用テスト。
- `cancel_before_confirmation` の正例・負例を増やすサンプル作成。
- 提案文の効果検証（関係者ヒアリングやテンプレ文改善）と、矛盾タイプごとの修正ワークフローを設計。

更新日: 2025-09-17

## 詳細報告（2025-09-17）

本研究は「C2-Graph」によって会議内のコミットメント操作（ASSIGN/CONFIRM/REVISE/CANCEL）を時系列で追跡し、矛盾の自動検出と是正アクションの提案を行うことを目的としている。研究ループは `AGENTS.md` に定義した Detect→Frame→Model/Hypothesize→Design→Run→Analyze→Update→Communicate→Decide のサイクルに則り、短いイテレーションで仮説検証を進める。今回のサイクルでは「矛盾を検出した瞬間に関係者が再発防止策を理解できるレポート」を目標に据え、矛盾タイプ別に推奨対応を自動生成する仕組みを設計した。

まず、既存の解析スクリプト `scripts/prototype/c2_graph_baseline.py` に `CONTRADICTION_SUGGESTIONS` を実装し、検出された矛盾（無割り当てキャンセル・権限外キャンセル・重複キャンセル・確認前キャンセル）ごとに再発防止アクションを紐付けた。これによりレポートは単なる違反列挙に留まらず、「誰が何をすべきか」の指針を提示できるようになった。また、未割り当て状態での CANCEL が発生した場合でも `CommitmentState` を更新して履歴を保持するよう改修し、矛盾率算出が 1.00 に正規化されることを確認した。

検証データとして、既存の `meeting-sample-001` と `meeting-sample-002` に加え、代表的な矛盾パターンを網羅した `meeting-sample-003` を新規作成した。このサンプルでは Frank によるオーナー外キャンセル、Eve による重複キャンセル、Dave の未割り当てキャンセル、Gina の確認前キャンセルを意図的に配置し、アルゴリズムが全ケースを正しく識別するかを確認している。各会議の解析結果は `runs/20250917-c2-proto-v2/` に保存し、バッチ集計ではコミットメント 8 件中 5 件が矛盾に該当、矛盾率 0.62、矛盾タイプ内訳（cancel_before_confirmation:2, cancel_without_assignment:1, duplicate_cancel:1, unauthorized_cancel:3）を提案文付きで可視化することに成功した。

今回の結果から、矛盾に伴う提案文がレポートに含まれることで、会議参加者が次に取るべきアクションを即座に共有できる手がかりが得られたと評価している。一方で、提案文は現状テンプレートベースであり、実際のチーム運用に適合させるには AMI や ICSI の実データを用いた妥当性検証や、利用者へのヒアリングを通じた文面改善が不可欠である。また、矛盾検出のカバレッジを高めるため、期限超過といった時間軸ルールやオーナー交代の再確認手続を組み込む必要がある。次サイクルでは実データ適用による定量評価と提案文の品質向上、ワークフロー化の検討を優先し、得られた知見をもとに研究テーマの継続・ピボット判断を行う計画である。
